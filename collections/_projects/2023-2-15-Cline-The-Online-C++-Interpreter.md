---
layout: article
title: Cline The Online C++ Interpreter
categories: Software
tags: c++ web
eyeCatcher: https://sdtelectronics.github.io/assets/gallery/2023-2-15-Cline-The-Online-C++-Interpreter.png
abstract: Aimed to bring the interactive C++ experience to the Internet, cline is a web application built upon many brilliant ideas. Discover the magic behind the user interface in this open-source project.
---

It's a great joy to introduce [cline, an online C++ interpreter](https://cppcli.net) here, which aimed to bring the chram of Cling to the broader public. With a simple and friendly interface, cline helps you to capture your spark of originality wherever the Internet is accessible. If you are curious about how the idea of cline was originated and turned into reality, this blogpost may answer some of your questions.

## Motivation
It would easily turn into a heated debate if developers were asked to rate languages based on the difficulty to learn. Meanwhile, we may all agree that Javascript will be among the easiest in mainstream languages. I myself got into programming with Javascript, and the top reason I would recommend it to a beginner is the easily accessible REPL. Allowing users to examine code line by line, it gives a deep insight into the internals of a program, plus one can take this power anywhere a browser is accessible. This is why I feel so excited when I first met Cling, which I thought has the potential to change how people learn and prototype with C++. However, the popularity Cling received didn't quite match my expectation. I recognized there might be another gap to fill: availability. What if people can use it on a web browser, just like a Javascript console?

## Challenges
The idea of turning a compiler into a web application is not something new. These days, people can even run a linux kernel in browser with the magic of WebAssembly. While it's tempting to port cling as a pure frontend application in the same way, it may not be desirable to send a huge bundle of headers and libraries over the network. Besides, whether this is possible at all remains questionable due to the immutable code segment in wasm, causing difficulties to the implementation of JIT compilation in Cling. A more conventional approach is to put the interpreter on the server, but still posing many challenges, particularly in security. Being able to access low-level primitives with C++, users can take over the whole server if no constraints are imposed. Another big headache is resource management. If this is to be done by Google or Amazon, they would just start a new virtual machine instance for each user, which also eliminates all security concerns. However, with limited resources, efficient utilization becomes critical, as well as ensuring that all users receive a fair share.

## Final design
The problem ultimately boils down to a tradeoff between efficiency and security, and the sweet spot I found is the process level of isolation provided by the OS. In the design based on this decision, the service creates a separate interpreter process for each connection, which is the bare minimum required to isolate fatal errors and essential resources like signals. Another advantage of this design is the management of the service can be simply handed over to the [websocketd program](https://github.com/joewalnes/websocketd), saving quite some work. This nice utility forks a cline process every time a new connection is accepted, and bridges the process with the websocket client through IPC. All of these are encapsulated in an unprivileged docker container to prevent interpreter processes from accessing resources in the host's namespace. The diagram below illustrates the overall architecture of the service:

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="630" height="390" viewBox="-0.5 -0.5 750 429"><path fill="none" stroke="#3bb0f5" stroke-width="3" stroke-dasharray="9 9" pointer-events="all" d="M51.02 124.75h663.39v301.18H51.02zm0-124.02h663.39v124.02H51.02z"/><rect x="220" y="139" width="480" height="250" rx="12.5" ry="12.5" fill="#3bb0f5" pointer-events="all"/><rect x="250" y="279" width="420" height="60" rx="9" ry="9" fill="#3179e6" pointer-events="all"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:418px;height:1px;padding-top:309px;margin-left:251px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><font style="font-size:21px">Websocketd</font></div></div></div></foreignObject><text x="460" y="313" fill="#F0F0F1" font-family="Helvetica" font-size="12" text-anchor="middle">Websocketd</text></switch><rect x="250" y="169" width="90" height="80" rx="12" ry="12" fill="#3179e6" pointer-events="all"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:88px;height:1px;padding-top:209px;margin-left:251px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><font style="font-size:21px">Cline</font></div></div></div></foreignObject><text x="295" y="213" fill="#F0F0F1" font-family="Helvetica" font-size="12" text-anchor="middle">Cline</text></switch><rect x="70" y="169" width="110" height="80" rx="12" ry="12" fill="#337ef0" pointer-events="all"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:108px;height:1px;padding-top:209px;margin-left:71px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><span style="font-size:21px">Proxy<br/>Server<br/></span></div></div></div></foreignObject><text x="125" y="213" fill="#F0F0F1" font-family="Helvetica" font-size="12" text-anchor="middle">Proxy...</text></switch><path fill="none" pointer-events="all" d="M230 349h230v30H230z"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:228px;height:1px;padding-top:364px;margin-left:231px"><div data-drawio-colors="color: #FFFFFF;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:21px;font-family:Helvetica;color:#fff;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">Docker Container</div></div></div></foreignObject><text x="345" y="370" fill="#FFF" font-family="Helvetica" font-size="21" text-anchor="middle">Docker Container</text></switch><path d="M238.4 309H125v-48.4" fill="none" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="m246.65 309-11 5.5 2.75-5.5-2.75-5.5ZM125 252.35l5.5 11-5.5-2.75-5.5 2.75Z" fill="#3179e6" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><path d="M263.2 111.77c-13.49 0-24.43-11.46-24.43-25.6 0-14.13 10.94-25.59 24.43-25.59 6.92-13.2 20.98-20.46 35.18-18.17 14.21 2.29 25.53 13.64 28.34 28.41 10.8 0 19.55 9.16 19.55 20.47 0 11.31-8.75 20.48-19.55 20.48Z" fill="#337ef0" pointer-events="all"/><path fill="none" pointer-events="all" d="M177.52 71.6h230v30h-230z"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:228px;height:1px;padding-top:87px;margin-left:179px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:21px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">Session1</div></div></div></foreignObject><text x="293" y="93" fill="#F0F0F1" font-family="Helvetica" font-size="21" text-anchor="middle">Session1</text></switch><path d="M392.61 111.77c-13.49 0-24.43-11.46-24.43-25.6 0-14.13 10.94-25.59 24.43-25.59 6.92-13.2 20.98-20.46 35.18-18.17 14.21 2.29 25.53 13.64 28.34 28.4 10.8 0 19.55 9.17 19.55 20.48s-8.75 20.48-19.55 20.48Z" fill="#337ef0" pointer-events="all"/><path fill="none" pointer-events="all" d="M306.93 71.6h230v30h-230z"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:228px;height:1px;padding-top:87px;margin-left:308px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:21px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">Session2</div></div></div></foreignObject><text x="422" y="93" fill="#F0F0F1" font-family="Helvetica" font-size="21" text-anchor="middle">Session2</text></switch><path d="M594.26 111.77c-13.49 0-24.43-11.46-24.43-25.6s10.94-25.6 24.43-25.6c6.92-13.19 20.97-20.45 35.18-18.16 14.2 2.29 25.53 13.64 28.34 28.4 10.8 0 19.55 9.17 19.55 20.48s-8.75 20.48-19.55 20.48Z" fill="#337ef0" pointer-events="all"/><path fill="none" pointer-events="all" d="M508.58 71.6h230v30h-230z"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:228px;height:1px;padding-top:87px;margin-left:510px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:21px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal">SessionX</div></div></div></foreignObject><text x="624" y="93" fill="#F0F0F1" font-family="Helvetica" font-size="21" text-anchor="middle">SessionX</text></switch><ellipse cx="157.98" cy="154.27" rx="8.855" ry="5.905" fill="#337ef0" pointer-events="all"/><ellipse cx="185.59" cy="138.52" rx="11.815" ry="7.87" fill="#337ef0" pointer-events="all"/><ellipse cx="216.13" cy="116.87" rx="13.865" ry="9.84" fill="#337ef0" pointer-events="all"/><path d="m295.17 270.9.07-13.8" fill="none" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="m295.14 277.65-4.46-9.03 4.49 2.28 4.51-2.23Zm.13-27.3 4.46 9.03-4.49-2.28-4.51 2.23Z" fill="#3179e6" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="375.83" y="169" width="90" height="80" rx="12" ry="12" fill="#3179e6" pointer-events="all"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:88px;height:1px;padding-top:209px;margin-left:377px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><font style="font-size:21px">Cline</font></div></div></div></foreignObject><text x="421" y="213" fill="#F0F0F1" font-family="Helvetica" font-size="12" text-anchor="middle">Cline</text></switch><path d="m421 270.89.07-13.79" fill="none" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="m420.97 277.64-4.46-9.02 4.49 2.27 4.51-2.22Zm.13-27.29 4.46 9.02-4.49-2.27-4.51 2.23Z" fill="#3179e6" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><rect x="578.58" y="169" width="90" height="80" rx="12" ry="12" fill="#3179e6" pointer-events="all"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:88px;height:1px;padding-top:209px;margin-left:580px"><div data-drawio-colors="color: #F0F0F1;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:12px;font-family:Helvetica;color:#f0f0f1;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><font style="font-size:21px">Cline</font></div></div></div></foreignObject><text x="624" y="213" fill="#F0F0F1" font-family="Helvetica" font-size="12" text-anchor="middle">Cline</text></switch><path d="m623.75 270.89.07-13.79" fill="none" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="stroke"/><path d="m623.71 277.64-4.45-9.02 4.49 2.27 4.51-2.22Zm.14-27.29 4.46 9.02-4.49-2.27-4.51 2.23Z" fill="#3179e6" stroke="#3179e6" stroke-width="3" stroke-miterlimit="10" pointer-events="all"/><circle cx="503.22" cy="84.83" fill="#337ef0" pointer-events="all" r="5.355"/><circle cx="520.28" cy="84.82" fill="#337ef0" pointer-events="all" r="5.355"/><circle cx="537.48" cy="84.82" fill="#337ef0" pointer-events="all" r="5.355"/><circle cx="503.15" cy="209" fill="#3179e6" pointer-events="all" r="5.355"/><circle cx="520.21" cy="209" fill="#3179e6" pointer-events="all" r="5.355"/><circle cx="537.41" cy="209" fill="#3179e6" pointer-events="all" r="5.355"/><path fill="none" pointer-events="all" d="M25.43 384.59h230v30h-230z"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:228px;height:1px;padding-top:400px;margin-left:26px"><div data-drawio-colors="color: #FFFFFF;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:21px;font-family:Helvetica;color:#fff;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><font color="#337ef0">Host Network</font></div></div></div></foreignObject><text x="140" y="406" fill="#FFF" font-family="Helvetica" font-size="21" text-anchor="middle">Host Network</text></switch><path fill="none" pointer-events="all" d="M0 8.61h230v30H0z"/><switch transform="translate(-.5 -.5)"><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:228px;height:1px;padding-top:24px;margin-left:1px"><div data-drawio-colors="color: #FFFFFF;" style="box-sizing:border-box;font-size:0;text-align:center"><div style="display:inline-block;font-size:21px;font-family:Helvetica;color:#fff;line-height:1.2;pointer-events:all;white-space:normal;overflow-wrap:normal"><font color="#337ef0">Internet</font></div></div></div></foreignObject><text x="115" y="30" fill="#FFF" font-family="Helvetica" font-size="21" text-anchor="middle">Internet</text></switch><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0 -5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>

Other sandboxing techniques put into use include [seccomp filter](https://www.kernel.org/doc/html/v5.0/userspace-api/seccomp_filter.html) and [Apparmor](https://apparmor.net/), employed by the interpreter and the container, respectively. These were set to intercept malicious system calls and deny accesses to sensitive locations in the file system. To be safe, the current filtering rules are rather strict, interfering with some important language features including [threads](https://github.com/SdtElectronics/cline/issues/6). A focus of the subsequent work will be to gradually lift these restrictions without compromising the security guarantee. Given all components described above, one could have a hard time putting them together. Ideally, all building and deploying procedure should be packed into a docker image, allowing users to easily host their own service and adjust the level of security as needed. This is another import objective for the near future.

## Outlooks
The cline project is still in the early stage of development. In addition to the plans mentioned above, more exciting features will be added soon. To name a few, [the permalink to code snippets](https://github.com/SdtElectronics/cline/issues/8) will allow easy code sharing, and [support to VT100 sequences](https://github.com/SdtElectronics/cline/issues/9) enables raw highlighting in messages the interpreter produce. Of course, the improvement of this open-source project cannot be made without *you*. Please submit an [issue](https://github.com/SdtElectronics/cline/issues) in the [Github repository](https://github.com/SdtElectronics/cline) if you find a bug or have any suggestion. Finally, I hope you all can enjoy this work!
